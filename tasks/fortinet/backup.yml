---
#https://github.com/fortinet-ansible-dev/ansible-galaxy-fortios-collection/issues/186
- name: Backup a Fortigate FW
  fortinet.fortios.fortios_monitor:
    vdom: "{{ fw_fg_vdom }}"
    access_token: "{{ fw_access_token }}"
    selector: 'backup.system.config'
    params:
      scope: 'global'
  register: backupinfo
 
- name: Debug backup content
  debug:
    var: backupinfo


# backup_server: "backup-server"
# backup_server_user: "root"
# backup_server_pass: "centos"
# backup_server_folder: "/tmp/backup/"

- name: Create backup folder on backup server
  ansible.builtin.file:
    path: "/tmp/backup/"
    state: directory
  become: true
  delegate_to: "backup-server"
  vars:
    ansible_user: "root"
    ansible_ssh_pass: "centos"

- name: Copy config to backup server
  copy:
    src: "/tmp/backup"
    dest: "/tmp/backup/fortinet_backup"
  become: true
  delegate_to: "backup-server"
  vars:
    ansible_user: "root"
    ansible_ssh_pass: "centos"

